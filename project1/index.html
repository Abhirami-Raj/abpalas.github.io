<!DOCTYPE html>
<html>
<head>
<title>Project 1 - sample code 2</title>
<script type="text/javascript" src="./d3/d3.js"></script>
<!--<script type="text/javascript" src="https://d3js.org//d3.v3.min.js"></script> -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
    	text { 
			font-family: Arial; 
			font-size: 15px;
		}
		.axis path, .axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}
		.tick text {
			fill: gray;
			font-size: 11px;
		}

		rect {
			stroke: white;
		}
		
	div.tooltip { 
    position: absolute;     
    text-align: center;     
    width: 80px;          
    height: 28px;         
    padding: 2px;       
    font: 12px sans-serif;    
    background: lightsteelblue; 
    border: 0px;    
    border-radius: 8px;     
    pointer-events: none;     
}

.bar1 {
  fill: steelblue;
}
.bar2 {
  fill: pink;
}

.bar1:hover {
  fill: brown;
}

.bar2:hover {
  fill: brown;
}


.axis--x path {
  display: none;
}

.svg {
  position: absolute;
  animation: panZoom 10s linear 1;
}

@keyframes panZoom {
  0%   {transform: translateX(0) scale(1);}
  100% {transform: translateX(1000px) scale(3);}
}

body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", sans-serif}
body, html {
    height: 100%;
    line-height: 1.8;
}
/* Full height image header */
.bgimg-1 {
    background-position: center;
    background-size: cover;
    background-image: url("/w3images/mac.jpg");
    min-height: 100%;
}
.w3-bar .w3-button {
    padding: 16px;
}

.legend rect {
  fill: white;
  fill-opacity: .85;
  stroke: white;
}
.legend text {
  font-size: 12px;
}
	</style>
</head>

<body>

<!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar w3-white w3-card" id="myNavbar">
    <a href="#home" class="w3-bar-item w3-button w3-wide"><b>LONDON'S 1854 CHOLERA EPIDEMIC</b></a>
    <!-- Right-sided navbar links -->
    <div class="w3-right w3-hide-small">
      <a href="#about" class="w3-bar-item w3-button"><b>ABOUT PROJECT</b></a>
	  <a href="#main" class="w3-bar-item w3-button"><b>VISUALIZATION</b></a>
      <a href="#documentation" class="w3-bar-item w3-button"></i><b>DOCUMENTATION</b></a>
      <a href="#video" class="w3-bar-item w3-button"><b></i>VIDEO</b></a>
    </div>
    <!-- Hide right-floated links on small screens and replace them with a menu icon -->

    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
      <i class="fa fa-bars"></i>
    </a>
  </div>
    <a href="javascript:void(0)" class="w3-bar-item w3-button w3-right w3-hide-large w3-hide-medium" onclick="w3_open()">
      <i class="fa fa-bars"></i>
    </a>
</div>
<!-- About Section -->
<div class="w3-container" style="padding:70px 16px" id="about">
  <h3 class="w3-center">ABOUT THE PROJECT</h3>
  <p class="w3-center w3-large">The London Broad Street cholera outbreak was a severe outbreak of cholera that occurred in 1854 near Broad Street in the Soho district of the City of Westminster, London, England. This outbreak, which killed 616 people, is best known for the physician John Snow's study of its causes and his hypothesis that germ-contaminated water was the source of cholera. It was the first time that anyone had established a link between contaminated water and cholera. The visualization provided compelling evidence and made the case for public health policies to improve water sanitation. The map remains one of the most remarkable and insightful visualizations ever created. In this project, I have tried to recreate Dr. John Snow's map as an interactive version using today's tools of trade, D3. I have also added additional charts to the side of the map, as well as interface elements to make the data more interactive. A line chart is created plotting the no. of deaths of victims on particular date to identify the date on which the maximum deaths occurred. This line graph is an interactive one where each date gives the total no. of deaths on the main street map, showing male and female separately. In addition to the line chart, a bar graph has been added to represent the no. of deaths based on sex and age group. The objective of this project is to overcome the difficulty in the analysis of London Cholera Outbreak from the old paper map and to provide an easy and efficient interactive visualization to help people find the insights of this data.</p>
</div>

<div class="row"> 
	 <h3>&nbsp Dr. John Snow's Map of London's 1854 cholera epidemic &nbsp&nbsp&nbsp&nbsp&nbsp</h3>
</div>

<svg id="main" width="600" height="500">
		<g id='street' transform="translate(-50,-20)"></g>
		<g id='victim' transform="translate(-50,-20)"></g>
		<g id='pump' transform="translate(-50,-20)"></g>                   // changed this and move this down
		<g id='victimonclick' transform="translate(-50,-20)"></g> 
		<g id='victim2' transform="translate(-50,-20)"></g>		
</svg>
	
<svg id="main1" width="550" height="500">
		<g id='deathdays' transform="translate(30,40)"></g>
</svg>	

<svg id="main2" width="900" height="350">
</svg>	

<script>
	
	 var width = 600         // changed this
	 var height = 600        // changed this , <> updated to 600 from 800
	 var streets=[];
	
	 //d3.select("button").on('click', zoomed);
	 //d3.selectAll('button').on('click', zoomed);
	 
	 var gstreet= d3.select('svg').select("#street");         //  added select('svg') here
	 var gpump= d3.select('svg').select("#pump");				//  added select('svg') here
	 var gvictim= d3.select('svg').select("#victim");			//  added select('svg') here
	 var gvictim2 = d3.select('svg').select('#victim2');
	 var gdeathdays= d3.select('svg').select("#deathdays");		//  added select('svg') here
	 var gvictimonclick = d3.select('svg').select("#victimonclick");  // added new group here
	 
	 var main = d3.select('#main');
	 var zoom = d3.behavior.zoom().scaleExtent([1, 4]).on("zoom", zoomed);
	 
	 main.call(zoom);
	 /*	 
	 var svgContainer = d3.select("body")
      .append("svgContainer")
      .attr("width", "100%")
      .attr("height", "100%")
      .call(d3.behavior.zoom().on("zoom", function () {
        svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
      }))
      .append("g")
	  
	  */
	
function zoomed() {
    main.attr("transform",
        "translate(" + zoom.translate() + ")" +
        "scale(" + zoom.scale() + ")"
    );
}

 var streetnames = [{name:'CEORCE STREET',x:120,y:222,rotate:72},{name:'BREWER STREET',x:355,y:390,rotate:-43},{name:'RECENT STREET',x:235,y:250,rotate:60},{name:'OXFORD STREET',x:298,y:89,rotate:-10},{name:'DEAN STREET',x:490,y:89,rotate:66},{name:'WORK',x:321.5,y:179,rotate:-23},{name:'HOUSE',x:325,y:192,rotate:-23},{name:'Brewery',x:411,y:212,rotate:65},{name:'BROAD STREET',x:322,y:250,rotate:-30}]
 var WorkHouse = [{x:311,y:170,w:45,h:38,rotate:-25}]
 var brewery = [{x:417,y:207.5,w:30,h:16,rotate:62.5}]

	
//To draw street map  
	
	d3.json('data/streets.json',function(error, streets) {
				streets.forEach(function(data){
					
					var lineCoords=d3.svg.line()
					.x(function(d) {return d.x*30;})
					.y(function(d) {return height-d.y*30;})
					.interpolate("linear"); 
					
			lineCoords(data);
			
	//set projection
    //var projection = d3.geoMercator().scale(1200).center([ 20, 8.5 ])
    // set projection parameters
    //projection.scale(1200).center([ 20, 8.5 ])
	// create path variable
    //var geoPath = d3.geoPath().projection(projection);
			
	var svgPath = gstreet
			//var svgPath = svgContainer
				//.attr("d", geoPath(lineCoords)).style("stroke", "#1c9099").attr("vector-effect", "non-scaling-stroke")
				//.attr("x", "-20px")
				//.attr("y", "20px")
				//g.selectAll("path")
				.append("path")
				.attr('stroke', 'grey')
    			.attr('stroke-width', '3px')
				.attr("stroke-opacity",0.8)
				.attr("fill", "none")
			    .attr("d", lineCoords(data));// modified here   			
			});
						
		  var work = gstreet.append("rect")
          .data(WorkHouse)
          .attr("transform", function (d) 
            { return "rotate(" + d.rotate + " " + d.x + "," + d.y+ ")"; })
          .attr("x", function(d) { return d.x; })
          .attr("y", function(d) { return d.y; })
          .attr("width", function(d) { return d.w; })
          .attr("height", function(d) { return d.h; })
          .attr("stroke", 'grey')
          .attr("stroke-opacity",0.8)
          .style("fill", "#b8e186"); 

          var brewary = gstreet.append("rect")
          .data(brewery)
          .attr("transform", function (d) 
            { return "rotate(" + d.rotate + " " + d.x + "," + d.y+ ")"; })
          .attr("x", function(d) { return d.x; })
          .attr("y", function(d) { return d.y; })
          .attr("width", function(d) { return d.w; })
          .attr("height", function(d) { return d.h; })
          .style("fill", "cyan");       

//name of streets
        gstreet.selectAll(".place-label")
          .data(streetnames)
          .enter().append("text")
          .attr("class", "place-label")
          .attr("transform", function (d) 
            { return "rotate(" + d.rotate + " " + d.x + "," + d.y+ ")"; })
          .attr("x", function(d) { return d.x; })
          .attr("y", function(d) { return d.y; })
          .attr("dy", ".35em")
          .text(function(d) { return d.name; });
		   
		});
		
//To insert pumps
	//var g = d3.select('svgContainer').select('gpump');
	
	d3.csv('data/pumps.csv',function(error, pumps) {
	
				  // svgContainer.selectAll("circle")
				    gpump.selectAll("circle")
					.data(pumps)
					.enter().append("circle")
					.attr("cx", function(d) { return d.x*30; })
					.attr("cy", function(d) { return height-d.y*30; })
					//var svgpump = svgContainer
					//.append('circle')
					.style('fill', 'black')
					.attr('r', 7)
					.attr("stroke", 'red')
					.attr("stroke-opacity",0.8);
				    //svgpump.attr("d", pumpcoords(data))
					//.attr('cx', function(d) {return d.x*30; })
					//.attr('cx', function(d) {return height-d.y*30; });
					
					});
					
	//var g = d3.select('svgContainer').select('gvictim');
	var color = ['#b2182b', '#ef8a62', '#fddbc7', '#d1e5f0', '#67a9cf', '#2166ac']
	d3.csv('data/deaths_age_sex.csv',function(error, victims) {
	
				   gvictim.selectAll("rect")
					.data(victims)
					.enter()
					.append("rect")
					.attr("x", function(d) { return d.x*30; })
					.attr("y", function(d) { return height-d.y*30; })
					.attr("age", function(d) {return d.age;})
					//var svgpump = svgContainer
					//.append('circle')
					.attr('width', 5)
					.attr('height',7)
					.style("fill", function(d) { return color[d.age]; })
					/*.style('fill', function(d)
					  {
						if(d.gender == "0")
						{return "blue";}
						else
						{return "lime";}
					  }
					) */
					//.style('fill', 'green')
					//.attr('r', 10)
					.attr("stroke", 'steelblue')
					.attr("stroke-opacity",0.8);
				
				    //svgpump.attr("d", pumpcoords(data))
					//.attr('cx', function(d) {return d.x*30; })
					//.attr('cx', function(d) {return height-d.y*30; });
					});  
					
			
//Overall Chart
var sdata=[];

d3.csv('data/deaths_age_sex.csv',function(deathagesex) {

		deathagesex.forEach(function(d){
		sdata.push({
			x: d.x*30,
			y: height-d.y*30,
			age: d.age,
			gender: d.gender
		});
		});
		
		console.log(sdata);
		
		var color = d3.scale.category20b();
		
		gvictim.selectAll("rect")
					.data(sdata)
					.attr("id","victims")
					.enter()
					.append("rect")
					.attr("x", function(d) { return d.x*30; })
					.attr("y", function(d) { return height-d.y*30; })
					.attr('width', 5)
					.attr('height',7)
					.style('fill', function(d){
				return "rgb("+ (255-(d["deaths"]*1.5))+",0,0)";
				});
					//.style('fill', function(d)
					  //{
						//if(d.gender == "0")
						//{return "blue";}
						//else
						//{return "lime";}
					  //}
					//)
	
		var age0m=0; var age0f=0; var age11f=0; var age11m=0; 
   		var age21f=0; var age21m=0; var age41f=0; var age41m=0; 
   		var age61f=0; var age61m=0; var age81f=0; var age81m=0;

		for (b=0;b<sdata.length;b++)
   			{
   				
   				var s=Number(sdata[b].age);
   				switch(s)
   				{

   					case 0:
   				

   						if(sdata[b].gender==0)
   						{
   							age0m+=1;
   						}else{
   							age0f+=1;
   						}

   						break;

   					case 1:

   						if(sdata[b].gender==0)
   						{
   							age11m+=1;
   						}else{
   							age11f+=1;
   						}

   						break;

   					case 2:
   						if(sdata[b].gender==0)
   						{
   							age21m+=1;
   						}else{
   							age21f+=1;
   						}

   						break;

   					case 3:
   						if(sdata[b].gender==0)
   						{
   							age41m+=1;
   						}else{
   							age41f+=1;
   						}

   						break;

   					case 4:
   						if(sdata[b].gender==0)
   						{
   							age61m+=1;
   						}else{
   							age61f+=1;
   						}

   						break;

   					case 5:
   						if(sdata[b].gender==0)
   						{
   							age81m+=1;
   						}else{
   							age81f+=1;
   						}

   						break;

   					default:
   					    console.log("errorrrr");
   				}

   			}

var totalgrouping = [{age: 5, male: age0m, female: age0f,age1:0,age2:10},
			   {age: 15, male: age11m, female: age11f,age1:11,age2:20},
   			   {age: 30, male: age21m, female: age21f,age1:21,age2:40},
			   {age: 50, male: age41m, female: age41f,age1:41,age2:60},
   			   {age: 70, male: age61m, female: age61f,age1:61,age2:80},
			   {age: 85, male: age81m, female: age81f,age1:80,age2:"higher"}]

console.log(totalgrouping);

//for bar chart

var margin2 = {top: 80, right: 80, bottom: 80, left: 80},
    w2 = 600 - margin2.left - margin2.right,        // <> updated from 1380 to 600
    h2 = 400 - margin2.top - margin2.bottom;  
	
var canvas2 =d3.select("#main2")
		.append("svg")
		.attr("width", w1 + margin2.left - margin2.right+400)
		.attr("height", 3*h1 + margin2.top + margin2.bottom)
		.append("g")
		.attr("class", "graph")
		.attr("transform", "translate(80,50)")
		//.attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");
		
var x1 = d3.scale.ordinal().rangeRoundBands([0, w2], .1);
var y0 = d3.scale.linear().domain([0, 100]).range([h2, 0]);
var y1 = d3.scale.linear().domain([0, 100]).range([h2, 0]);

var xAxis1 = d3.svg.axis()
    .scale(x1)
    .orient("bottom");
	
// create left yAxis
var yAxisLeft = d3.svg.axis().scale(y0).ticks(4).orient("left");

// create right yAxis
var yAxisRight = d3.svg.axis().scale(y1).ticks(4).orient("right");	

  x1.domain(totalgrouping.map(function(d) { return d.age1+ " to "+ d.age2; }));

  y0.domain([0, d3.max(totalgrouping, function(d) {
									 if(d.male>d.female){return d.male;}
                                                    else{return d.female;} 
											})]);

  y1.domain([0, d3.max(totalgrouping, function(d) { 
									if(d.male>d.female){return d.male;}
									else{return d.female;} 
									        })]);	
 canvas2.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + h2 + ")")
      .call(xAxis1)
      .append("text")
    .attr("x", 6)
    .attr("dx", "5em")
	.attr("dy", "3em")
    .style("text-anchor", "begin")
    .text("No. of deaths by age group and gender");

  canvas2.append("g")
    .attr("class", "y axis axisLeft")
    .attr("transform", "translate(0,0)")
    .call(yAxisLeft)
  .append("text")
  .attr("x", 10)
    .attr("y", 15)
    .attr("dy", "-2em")
    .style("text-anchor", "end")
    .text("Deaths");	
	
bars = canvas2.selectAll(".bar").data(totalgrouping).enter();

bars.append("rect")
      .attr("class", "bar1")
      .attr("x", function(d) { return x1(d.age); })
      .attr("width", x1.rangeBand()/2)
      .attr("y", function(d) { return y0(d.male); })
      .attr("height", function(d,i,j) { return h2 - y0(d.male); }) 
	  //.attr("fill", function(d) {return "rgb(100,"+ (130 + ((d.age+5)*1.5))+",0)"});
	  //.on("mouseover", function(d){            ///  added on click here, you need to figure out how to erase first plot and show 2nd one. you will either have to use remove() or visibility().
	  //place_victims_onclick();				///  this function is placing all the 571 points when you click, you need to find a way to count the people till this day and show those in the plot.
	  //})
	  
bars.append("rect")
      .attr("class", "bar2")
      .attr("x", function(d) { return x1(d.age) + x1.rangeBand()/2; })
      .attr("width", x1.rangeBand() / 2)
      .attr("y", function(d) { return y1(d.female); })
      .attr("height", function(d,i,j) { return h2 - y1(d.female); }) 
	  //.attr("fill", function(d) {return "rgb(100,"+ (130 + ((d.age+5)*1.5))+",0)"});
	  //.on("mouseover", function(d){            ///  added on click here, you need to figure out how to erase first plot and show 2nd one. you will either have to use remove() or visibility().
	  //place_victims_onclick();				///  this function is placing all the 571 points when you click, you need to find a way to count the people till this day and show those in the plot.
	  //})
			
	//Text for female bars	
	canvas2.selectAll("text.bar")
		   .data(totalgrouping)
           .enter().append("text")
						.text(function(d) {return d.female;})
						.attr("text-anchor", "middle")
						.attr("x", function(d, i) {return x1(d.age) + x1.rangeBand()/1.35;})
						.attr("y", function(d) {return y1(d.female)-2;})
						.attr("font-family", "sans-serif")
						.attr("font-size", "11px")
						.attr("fill", "gray");
						
	//Text for male bars
	canvas2.selectAll("text.bar")
  				.data(totalgrouping)
				.enter().append("text")
						.text(function(d) {return d.male;})
						.attr("text-anchor", "middle")
						.attr("x", function(d, i) {return x1(d.age) + x1.rangeBand()/4;})
						.attr("y", function(d) {return y0(d.male)-2;})
						.attr("font-family", "sans-serif")
						.attr("font-size", "11px")
						.attr("fill", "gray");

 //add legend for canvas2-------------------------------------------------------------
 // rectmale= canvas2.selectAll(".bar").data(totalgrouping).enter(); 
 // rectfemale=canvas2.selectAll(".bar").data(totalgrouping).enter(); 
  
  var legend = canvas2.append( 'g' )
      .attr( 'class', 'legend' )
      .attr( 'transform', 'translate(450,15)' );

  legend.append( 'rect' )
      .attr( 'width', 180 )
      .attr( 'height', 66 );

  var rectmale = legend.append( 'g' )
	  .append( 'rect' )
	  .attr( 'width', 10 )
      .attr( 'height', 10 )
      .style('fill','steelblue')
      .attr( 'transform', 'translate(20,22)' );
	  
  var label_rectmale = legend.append( 'g' )  
  label_rectmale.append( 'text' )
      .attr( 'x',40 )
	  //.attr( 'class', 'bar1' )
	  .style('fill','steelblue')
      .text( 'Male' )
      .attr( 'dy', '2.5em' );
      //label1.append( 'path' )
      //.attr( 'd', deaths );
	 
  var rectfemale = legend.append( 'g' )
	  .append( 'rect' )
	  .attr( 'width', 10 )
      .attr( 'height', 10 )
      .style('fill','pink')
      .attr( 'transform', 'translate(20,47)' );

  var label_rectfemale = legend.append( 'g' )
      .attr( 'class', 'bar2' )
      .attr( 'transform', 'translate(20,47)' );
  label_rectfemale.append( 'text' )
      .attr( 'x', 20 )
      .text( 'Female' )
      .attr( 'dy', '.55em' );
  //label2.append( 'path' )
     // .attr( 'd', pump );	  
						
});	

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Functions for death plotting--- line chart & Street map
var deathagesex=[];
		
		
d3.csv("data/deaths_age_sex.csv",function(deaths)
			{  
				deathagesex = deaths;
				
				
				deathbyage1();
			});
			
function deathbyage1()
		{ 
	  
	 		var death1 =  gvictim.selectAll('rect')
				.data(deathagesex)
				.enter()
    			.append('rect')
				.attr("id","deathbyage1")
				.attr("width",5)
				.attr("height",7)
				.attr("x", function(d) { return d.x*30; })
				.attr("y", function(d) { return height-d.y*30; })
				//.attr("stroke-width",0.1)
				.attr("stroke", 'steelblue')
				.attr("stroke-opacity",0.8)
				.style("fill", function(d) { return color[d.age]; })
				/*.attr("fill", function(d){
				if (d["gender"] == '0')
				   { 
				   return "rgb(100,"+ (((d["age"]+5)*1.5)) + 100+",0)";
					}
				else
				   { 
				   return "rgb(0,"+ (130 + ((d["age"] + 8)*1.5))+",255)";
					}
					}); */
		}
		
function deathbyage2(a)
		{ 
	     console.log('inside plot deaths2');
	var death2 =  gvictim2.selectAll('rect')
			    .data(deathagesex);
		
		death2.enter()
    			.append('rect')
				.attr("width",function(d,j){if ( j <= a){ return 5;}
											else {return 0;}
				})
	
				.attr("height",7)
				.attr("x", function(d) { return d.x*30; })
				.attr("y", function(d) { return height-d.y*30; })
				.attr("stroke-width",0.1)
				.attr("stroke", 'steelblue')
				.attr("stroke-opacity",0.8)
				.attr("fill", function(d){
				if (d["gender"] == '0')
				   { 
				   return '#ff6361';
		//		   return "rgb(120,"+ (130 + (d["age"]*1.5))+",0)";
					}
				else
				   { 
				   return '#35A0AF';
		//		   return "rgb(0,"+ (130 + (d["age"]*1.5))+",120)";
					}
				});		                             
		}
		
	function removedeathbyage1() {
			
		 d3.select('#victim').selectAll('*').remove();
			
		}
		
	function removedeathbyage2() {
			
		 d3.select('#victim2').selectAll('*').remove();
			
		}
	
//for line chart	  
var	margin1 = {top: 30, right: 20, bottom: 30, left: 50},
	w1 = 500 - margin1.left - margin1.right,        // <> updated to 1300
	h1 = 300 - margin1.top - margin1.bottom;
	
//Line Chart to plot death days

// Parse the date / time
var	parseDate = d3.time.format("%d-%b").parse;
var formatTime = d3.time.format("%e %B");

// Set the ranges
var	x = d3.time.scale().range([0, w1]);     // <> updated to 650
var	y = d3.scale.linear().range([h1, 0]);

// Define the axes
var	xAxis = d3.svg.axis().scale(x)
	.orient("bottom").ticks(5);

var	yAxis = d3.svg.axis().scale(y)
	.orient("left").ticks(8);
	
var	line = d3.svg.line()
.x(function(d) { return x(d.date); })
.y(function(d) { return y(d.deaths); });

// svg for line chart	
var	canvas1 = d3.select("#main1")
		.append("svg")
		.attr("width", w1 + margin1.left - margin1.right+200)
		.attr("height", 3*h1 + margin1.top + margin1.bottom)
		.append("g")
		.attr("transform", "translate(80,20)");
		

	d3.csv('data/deathdays.csv', function(data) 
		{
		data.forEach(function(d) 
		{
		
		var totaldeaths = data.length;
			d.date = parseDate(d.date);
			d.deaths = +d.deaths;
			d.age=+d.age;
			d.gender=+d.gender;
		});
				
	//Scale the data	
		x.domain(d3.extent(data, function(d) {return d.date;}));
		y.domain([0, d3.max(data, function(d) {return d.deaths;})]);
		
	// Add the X Axis
	canvas1.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(10," + h1 + ")")
		.call(xAxis)
		.append("text")
                .attr("transform", "translate(100,10)")
                .attr("x", 300)
                .attr("dy", "2em")
                .style("text-anchor", "end")
                .text("Timeline of number of deaths over a period of time");;

	// Add the Y Axis
	canvas1.append("g")
		.attr("class", "y axis")
		.call(yAxis)
		.attr('transform','translate(0,0)')               // <> added the transform attribute here
		.append("text")
                .attr("transform", "rotate(-90)")
				//.attr('transform','translate(0,200)') 
                .attr("y", 100)
                .attr("dy", "-9em")
                .style("text-anchor", "end")
                .text("Number of deaths");;		
		
	// Add the path.
	canvas1.append("path")
		.attr("class", "line")
		.attr("d", line(data))
		.attr("stroke", "grey")
   		.attr("stroke-width", "2px");
		
	canvas1.selectAll("dot")  
        .data(data)     
		.enter().append("ellipse")                 
        .attr("cx", function(d) { return x(d.date); })     
        .attr("cy", function(d) { return y(d.deaths); })
        .attr("rx", 5) 
        .attr("ry", 5)
		.style('fill', function(d){
				return "rgb(50,200,"+ (100+(d["deaths"]*1.5))+")";
				})
    //.style("fill", "red") 
        .attr("stroke", 'steelblue')
		.on("mouseover", function(d,i){
					d3.select(this).attr('fill','green');
					count = d3.sum(data,function(data,j)              
					{ if (j <= i)
						{ return data["deaths"]
						}
					});
					
					removedeathbyage1();
					deathbyage2(count - 1);
		  
					})
					
		.on("mouseout", function(d,i){
					removedeathbyage2();
					deathbyage1();
		  
					});
										
//add legend for Street map - pump, workhouse and brewery-------------------------------------------------------------
	  
	  var legend2 = canvas1.append( 'g' )
		  .attr( 'class', 'legend' )
		  .attr( 'transform', 'translate(-98,350)' );

	  legend2.append( 'rect' )
		  .attr( 'width', 180 )
		  .attr( 'height', 66 );
		  
	  var label_streets = legend2.append( 'g' )  
	  label_streets.append( 'text' )
		  .attr( 'x',18 )
		  .style('fill','black')
		  .text( 'Street Map Locations' )
		  .attr( 'dy', '.5em' );

	  var circlepump = legend2.append( 'g' )
		  .append( 'circle' )
		  .attr('r', 7)		
		  .style('fill','black')
		  .attr( 'transform', 'translate(25,25)' );
		  
	  var label_circlepump = legend2.append( 'g' )  
	  label_circlepump.append( 'text' )
		  .attr( 'x',40 )
		  .style('fill','steelblue')
		  .text( 'Water Pumps' )
		  .attr( 'dy', '2.5em' );
		 
	  var workhouse = legend2.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#b8e186')
		  .attr( 'transform', 'translate(18,40)' );

	  var label_workhouse = legend2.append( 'g' )
		  .attr( 'transform', 'translate(20,40)' );	  
	  label_workhouse.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Work House' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );

	  var brewery = legend2.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','cyan')
		  .attr( 'transform', 'translate(18,60)' );

	  var label_brewery = legend2.append( 'g' )
		  .attr( 'transform', 'translate(20,60)' );	  
	  label_brewery.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Brewery' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );	

//add legend for Street map - age groups -------------------------------------------------------------
		  
	  var legend4 = canvas1.append( 'g' )
		  .attr( 'class', 'legend' )
		  .attr( 'transform', 'translate(98,285)' );

	  legend4.append( 'rect' )
		  .attr( 'width', 180 )
		  .attr( 'height', 66 );
		  
	  var label_agegroup= legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,80)' );	  
	  label_agegroup.append( 'text' )
		  .attr( 'x', -2.0 )
		  .text( 'Street Map Age Groups' )
		  .style('fill','black')
		  .attr( 'dy', '-.85em' );
			
	  var age010 = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#b2182b')
		  .attr( 'transform', 'translate(18,80)' );

	  var label010 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,80)' );	  
	  label010.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age 0-10' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );

	  var age1120 = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#ef8a62')
		  .attr( 'transform', 'translate(18,100)' );

	  var label1120 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,100)' );	  
	  label1120.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age 11-20' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );	

	  var age2140 = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#fddbc7')
		  .attr( 'transform', 'translate(18,120)' );

	  var label2140 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,120)' );	  
	  label2140.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age 21-40 ' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );

	  var age4160 = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#d1e5f0')
		  .attr( 'transform', 'translate(18,140)' );

	  var label4160 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,140)' );	  
	  label4160.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age 41-60' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );	

	  var age6180 = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#67a9cf')
		  .attr( 'transform', 'translate(18,160)' );

	  var label6180 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,160)' );	  
	  label6180.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age 61-80' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );

	  var age80  = legend4.append( 'g' )
		  .append( 'rect' )
		  .attr( 'width', 15 )
		  .attr( 'height', 12 )
		  .style('fill','#2166ac')
		  .attr( 'transform', 'translate(18,180)' );

	  var label80 = legend4.append( 'g' )
		  .attr( 'transform', 'translate(20,180)' );	  
	  label80.append( 'text' )
		  .attr( 'x', 20 )
		  .text( 'Age > 80' )
		  .style('fill','steelblue')
		  .attr( 'dy', '.78em' );

//add legend for Canvas1 - dotted map -------------------------------------------------------------
	  
	  var legend3 = canvas1.append( 'g' )
		  .attr( 'class', 'legend' )
		  .attr( 'transform', 'translate(300,350)' );

	  legend3.append( 'rect' )
		  .attr( 'width', 180 )
		  .attr( 'height', 66 );
		  
	  var label_mouseover = legend3.append( 'g' )  
	  label_mouseover.append( 'text' )
		  .attr( 'x',18)
		  .style('fill','black')
		  .text( 'Gender on Mouse Over' )
		  .attr( 'dy', '.5em' );

	  var malevictims = legend3.append( 'g' )
		  .append( 'circle' )
		  .attr('r', 7)		
		  .style('fill','#ff6361')
		  .attr( 'transform', 'translate(25,25)' );
		  
	  var label_malevictims = legend3.append( 'g' )  
	  label_malevictims.append( 'text' )
		  .attr( 'x',40 )
		  .style('fill','#ff6361')
		  .text( 'Female' )
		  .attr( 'dy', '2.5em' );	
		  
	  var femalevictims = legend3.append( 'g' )
		  .append( 'circle' )
		  .attr('r', 7)		
		  .style('fill','#35A0AF')
		  .attr( 'transform', 'translate(25,50)' );
		  
	  var label_femalevictims = legend3.append( 'g' )  
	  label_femalevictims.append( 'text' )
		  .attr( 'x',40 )
		  .style('fill','#35A0AF')
		  .text( 'Male' )
		  .attr( 'dy', '4.5em' );			  
		 
					
		})		
</script>

<!-- About Section -->
<div class="w3-container" style="padding:10px 16px" id="documentation">
  <h3 class="w3-center">DOCUMENTATION</h3>
  <p class="w3-center w3-large">The London Broad Street cholera outbreak was a severe outbreak of cholera that occurred in 1854 near Broad Street in the Soho district of the City of Westminster, London, England. This outbreak, which killed 616 people, is best known for the physician John Snow's study of its causes and his hypothesis that germ-contaminated water was the source of cholera. It was the first time that anyone had established a link between contaminated water and cholera. The visualization provided compelling evidence and made the case for public health policies to improve water sanitation. The map remains one of the most remarkable and insightful visualizations ever created. In this project, I have tried to recreate Dr. John Snow's map as an interactive version using today's tools of trade, D3. I have also added additional charts to the side of the map, as well as interface elements to make the data more interactive. A line chart is created plotting the no. of deaths of victims on particular date to identify the date on which the maximum deaths occurred. This line graph is an interactive one where each date gives the total no. of deaths on the main street map, showing male and female separately. In addition to the line chart, a bar graph has been added to represent the no. of deaths based on sex and age group. The objective of this project is to overcome the difficulty in the analysis of London Cholera Outbreak from the old paper map and to provide an easy and efficient interactive visualization to help people find the insights of this data.</p>
  	<h4>Design Process</h4>
	<p>
	I first looked in to the datasets provided and tried to understand the requirements for the project. Next step was to list out what all steps have to be done as shown in fig1. I decided to plot the number of deaths based on the date in a line chart and was confused about plotting the number of deaths based on age group in a pie chart or bar chart. 
	</p>
	<img src="img/requirement_list.jpg" width="30%" height="30%" ></img></br><p style="text-align: center;color: black;">Fg1.</p>
    <p>
    Then the layout design was considered and I tried a basic design that shows how the various contents should be aligned in the webpage. The D3 book by Scott Murray <a href="http://chimera.labs.oreilly.com/books/1230000000345/index.html" class="page-scroll" >"Interactive Data Visualization for the Web with D3"(Scott Murray,  March 2013) </a> helped me to understand the basics of d3 coding. The initial design lay outs are as shown in figures below. 
    </p>
    <img src="img/designlayout1.jpg" width="30%" height="30%" ></img></br><p style="text-align: center;color: black;">Fg2.</p>
    <img src="img/designlayout2.jpg" width="30%" height="30%" ></img></br><p style="text-align: center;color: black;">Fg3.</p>
    <p>
    In order to get an idea of how the datasets are working, I used tableau to plot the data in the provided datasets and this helped me to understand the insights in the datasets to be more focused.
    I could not plot all the datasets effectively as expected in tableau and so I analysed the data by reading through the datasets. Some of the results from tableau plotting is given below:
    After having an idea of what should be plotted, I began to work on the plotting of streetmap.
    </p>
    <img src="img/bar_deaths_date.png" width="30%" height="30%" ></img></br><p style="text-align: center;color: black;">Fg4.</p>

    <h4>Rationale of design choices</h4>
    <p>In order to start with the designing, I researched a lot in internet to get more ideas such as usage of color, shapes, orientations etc.</p>
    <h4>Main street Map</h4>
    <p>
	  The position of the street map is set at left top as I understood that the street map is the most important part of the visualization. 
	  I first choose black for the street coordinates, but then realized the difficulty in viewing the other constraints and changed the color in to gray.
	  As the requirements suggested, I had to show the victims grouped based on gender (male and female) and age group.I decided to use color as a constrain to separate the gender and age groups.
	  So, I just chose a simple way that the female is pink, the male is blue, and used different color in saturation sequence to identify the age so that the victims could be identified based on both sex and age.
	  As I wanted the victims and water pumps to be easily identified, I used shape constrain to separate them. The pump is denoted as cicle filled with black to make them notable and the victims are denoted as small rectangles.
	  Also, the set of color has been tested by <a href="http://colororacle.org/" class="page-scroll" >colororacle</a>[4]. 
	</p>

    <h4>Line Graph</h4>
    <p>
	  Initially the position of the line chart was kept just below the street map but, when I started working on transitions from line chart to street map, it became difficult to see it without scrolling. 
	  In order to avoid difficulty, I changed the  position of the line graph to the right of street map. 
	  The line is drawn with thick gray and the area inside the graph is filled black. Different dots are given according to date points for mouse over function so that when the user mouse overs on the dots, the number of deaths till that date is shown in the street map.
	  The victims shown on street map as a mouse over transition is classified based on gender. The blue shade represents male and pink shade represends female.
	  I choose these colors based on the normal consideration that pink is for women and blue is for men.
	  A mouse out function is also given such that it shows the total victims on street map classified based on age with color variations.
	  I have also added color variation for the dots on the line graph in such a way that as the no. of deaths increases, the blue color saturation increases.
	 </p>

	 <h4>Bar Graph</h4>
     <p>
  
     </p>
     <img src="images/pump.png" width="40%" height="40%"></img>

    <h4>Buildings color and street name</h4>
  <p>
  As the first B requirement “more data to the map - major street names and the location of the brewery and the work house”, I think these are not the main information that uses would like to know initially, so the street name I made it small with thin white stroke,make it easy to catch but not in detail, and the buildings color in totally different color from the death points, and the building name in white color which reduces the visual interference.
  </p>

  <h4>Timeline graph</h4>
  <p>
  As the C requirement on timeline graph, it needs to not only show the number of deaths per day but also be clickable to choose which day to visualize the deaths on the map. So, I chose bar chart with the number on the top of each bar which is easy to click a bar to choose which day, even though I know that line chart would be more proper to show the trend of the number of deaths per day.  As for the color that I chose, it is from Huang’s option. He used to be a visualization designer in E-Business company, I believe his choice. The color looked soft and matched with the set of death points color.
  </p>

  <h4>Distribution graph of deaths by sex and age overall</h4>
  <p>
  Since this graph aims to compare, the bar chart is very suitable. As the bar color of female and male, I use pink(#faadc6) for female and blue(steel blue) for male as people common sense that red for women and blue for men. These two colors are also from Huang’s choice while I think it is matched the whole website color style.
  </p>

  <h4>The button style</h4>
  <p>
  At last, the button style is from website template, I think it’s obvious so that when users do some operation, they can notice the buttons.
  </p>
  
  <h4>Color test</h4>
  <p>
  Here are the color test by Colororacle[4]. 
  </p>
    <img src="images/Color1.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg5. Deuteranopia(Common)</p>
    <img src="images/Color2.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg6. Protanopia(Rare)</p>
    <img src="images/Color3.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg7. Tritanopia(Very rare)</p>

  <h3>Questions & Discoveries</h3>
  <h4>Q1. What day that the number of deaths is the most? What age of deaths is the most at that day?</h4>
  <p>
  It is easily to see that the biggest number of deaths is at 1-Sep and the subsequence is at 2-Sep. Through the chart on the top, I can get that the number of deaths mainly concentrate between 30-Aug to 7-Sep. When focusing on the 1-Sep, the map shows that the deaths mainly concentrate on Broad Street, and the color of death points show that the age is mainly concentrate on >80.
  </p>
  <img src="images/Q1-1.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg8. Distribution of deaths on 1-Sep</p>
  <img src="images/Q1-2.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg9. Magnified screenshot of the concentrated area on 1-Sep</p>

  <h4>Q2. Why the number of deaths suddenly rise up so much on 1-Sep?</h4>
  <p>
  I filter per day before 1-Sep. Between 17-Aug and 29-Aug, the death is very little but most of the death near the Broad Street and their water would be from the Broad Street pump. As on 30-Aug, the number of deaths is 8, when focusing on this day, the distribution of deaths shows as Fg9.  One death very near the pump since the former days there are 3 deaths also near the pump’s street.
  </p>
  <img src="images/Q2-1.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg10. Distribution of deaths on 30-Aug</p>
  <p>
  When focusing on 31-Aug, the death of people rise up about 7 times of that on the former day(Fg10)!  And the age of deaths mainly concentrates on 0-10 and >80, which is the poor physical resistance group. This time, the deaths are more near the Broad Street pump and the number of deaths which near the pump also gets bigger. So, combining with John Snow’s hypothesis, it is reasonable that the pump in Broad Street was contaminated and caused the culprit of death.
  </p>
  <img src="images/Q2-2.png" width="70%" height="70%"></img>
  <p style="text-align: center;color: black;">Fg11. Distribution of deaths on 31-Aug</p>

  <h4>Q3. Why there is still a small number of deaths after the pump handle removal on 8-Sep of so many days?</h4>
  <p>
  I filter per day after 11-Sep, and the data shows that these deaths are mainly concentrated on the Broad Street or using water from the Broad Street pump and their ages also mainly are 0-10 or >80, which I can assume that the deaths may be caused by the remainder of virus in the water or on the pump. And as common sense, 0-10 and >80 (especially for female) is the group that in poor physical resistance, so it is reasonable that the deaths were caused by the remainders of cholera, since there is almost no 21-60 age death.
  </p>
  <img src="images/Q3.png" width="100%" height="100%"></img>
  <p style="text-align: center;color: black;">Fg12. Distribution of deaths between 12-Sep and 27-Sep</p>

<h3>Reference</h3>
<p >
My JSON data is from the python script which is written by my undergraduate classmate Yihuang Cai[3].</br>
My style css is one of the models from China webmaster[8] where there are many good styling codes for free, and Huang Fu helps me on the both css and color style.</br>
My main function codes are from the D3 book[2], the stackoverflow[5], the bl.ocks[6], and the github[7] where there are many sources of D3 API and functions. </br>
</p>
<p>
[1]Victor Mateevitsi 2009.JOHN SNOW’S INTERACTIVE CHOLERA MAP</br>
<a href="http://www.vmateevitsi.com/2009/09/01/john-snows-interactive-cholera-map/" class="page-scroll" >http://www.vmateevitsi.com/2009/09/01/john-snows-interactive-cholera-map/</a>  
</p>

<p>
[2]Scott Murray,  March 2013.Interactive Data Visualization for the Web with D3</br>

<a href="http://chimera.labs.oreilly.com/books/1230000000345/index.html" class="page-scroll" >http://chimera.labs.oreilly.com/books/1230000000345/index.html</a>  
</p>

<p>
[3]Yihuang Cai, help to generate JSON data with python. The link is his homepage.</br>
<a href="http://chellynov.github.io" class="page-scroll" >http://chellynov.github.io</a>  
</p>

<p>[4]Colororacle</br>
<a href="http://colororacle.org/" class="page-scroll" >http://colororacle.org</a>  
</p>

<p>[5]StackOverFlow</br>
<a href="https://stackoverflow.com/" class="page-scroll" >https://stackoverflow.com</a>  
</p>

<p>[6]Bl.Ocks</br>
<a href="https://bl.ocks.org" class="page-scroll" >https://bl.ocks.org</a>  
</p>

<p>[7]D3 Github</br>
<a href="https://github.com/d3/d3-3.x-api-reference" class="page-scroll" >https://github.com/d3/d3-3.x-api-reference</a>  
</p>

<p>[8]China Webmaster(style template)</br>
<a href="http://sc.chinaz.com" class="page-scroll" >http://sc.chinaz.com</a>  
</p>
  
  </div>
			
</body>
</html>					